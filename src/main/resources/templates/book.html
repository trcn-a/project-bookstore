<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title th:text="${book.title}">–î–µ—Ç–∞–ª—ñ –∫–Ω–∏–≥–∏</title>
    <link rel="stylesheet" th:href="@{/css/book.css}">
</head>
<body>

<div th:replace="~{fragments/header :: body}"></div>

<main class="book-container">
    <div class="image-section">
        <img alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–Ω–∏–≥–∏" class="book-image" th:src="@{/images/{coverImage}(coverImage=${book.coverImage})}">
    </div>

    <div class="book-details">
        <h1 class="book-title" th:text="${book.title}">–ù–∞–∑–≤–∞ –∫–Ω–∏–≥–∏</h1>
        <p class="book-author">
            <span>–ê–≤—Ç–æ—Ä: </span>
            <span> <a th:href="@{/author/{id}(id=${book.author.getId()})}" th:text="${book.getAuthor().getName()}"></a></span>

        </p>

        <dl class="book-info">

            <dt>–ñ–∞–Ω—Ä:</dt>
            <dd th:text="${book.genre.getName()}"></dd>

            <dt>–í–∏–¥–∞–≤–Ω–∏—Ü—Ç–≤–æ:</dt>
            <dd th:text="${book.publisher.name}">–ù–∞–∑–≤–∞ –≤–∏–¥–∞–≤–Ω–∏—Ü—Ç–≤–∞</dd>

            <dt>–†—ñ–∫ –≤–∏–¥–∞–Ω–Ω—è:</dt>
            <dd th:text="${book.publicationYear}">2024</dd>

            <dt>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫:</dt>
            <dd th:text="${book.pages}">300</dd>

            <dt>–ú–æ–≤–∞:</dt>
            <dd>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</dd>

            <dt>–û–±–∫–ª–∞–¥–∏–Ω–∫–∞:</dt>
            <dd th:text="${book.coverType}">–¢–≤–µ—Ä–¥–∞</dd>
            <dt>–§–æ—Ä–º–∞—Ç –∫–Ω–∏–≥–∏:</dt>
            <dd th:text="${book.bookFormat}">–¢–≤–µ—Ä–¥–∞</dd>

            <dt>ISBN:</dt>
            <dd th:text="${book.isbn}">978-XXXXXXXXXX</dd>
        </dl>


        <p class="book-description" th:text="${book.description}">
            –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∫–Ω–∏–≥–∏...
        </p>

        <div class="price-section">
            <div class="price-details">
                <div class="original-price" th:if="${book.discount != null}">
                    <span class="price-label">–ü–æ–≤–Ω–∞ —Ü—ñ–Ω–∞:</span>
                    <span class="price-value crossed" th:text="${book.price} + ' –≥—Ä–Ω'">250 –≥—Ä–Ω</span>
                    <span class="discount-badge" th:text="'-' + ${book.discount} + '%'">-20%</span>
                </div>
                <div class="current-price">
                    <span class="price-label">–ê–∫—Ç—É–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞:</span>
                    <span class="price-value" th:text="${book.actualPrice} + ' –≥—Ä–Ω'">200 –≥—Ä–Ω</span>
                </div>
            </div>
        </div>
        <div th:replace="~{fragments/cart-button :: cart-button(book=${book}, cartBookIds=${cartBookIds}, fromPage='/book/' + ${book.id})}"></div>

        <form method="post" th:action="@{/favorites/add/{id}(id=${book.id})}">
            <button type="submit">–î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ</button>
        </form>
        <form method="post"
              th:action="@{${favoriteBookIds.contains(book.id) ? '/favorites/remove/' + book.id : '/favorites/add/' + book.id}}">
            <input name="fromPage" th:value="'/book/' + ${book.id}" type="hidden">
            <button style="background: none; border: none; cursor: pointer; font-size: 1.5rem;" type="submit">
                <span th:text="${favoriteBookIds.contains(book.id) ? '‚ù§Ô∏è' : 'ü§ç'}"></span>
            </button>
        </form>

        <div>
            <p>–°–µ—Ä–µ–¥–Ω—è –æ—Ü—ñ–Ω–∫–∞:
                <span th:text="${#numbers.formatDecimal(averageRating, 1, 1)}"></span> / 5
            </p>

            <p>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Ü—ñ–Ω–æ–∫: <span th:text="${reviews.size()}"></span>

            </p>
            <div>
                <div class="review-rating">
   <span th:class="${i < averageRating ? (i < averageRating - 0.5 ? 'fas fa-star' : 'fas fa-star-half-alt') : 'far fa-star'}"
         th:each="i : ${#numbers.sequence(0, 4)}">
</span>

                </div>

            </div>
        </div></div>
        <h3>–í—ñ–¥–≥—É–∫–∏:</h3>
        <ul>
            <li th:each="review : ${reviews}">
                <div class="review-rating">
                <span th:class="${i < review.rating ? 'fas fa-star' : 'far fa-star'}"
                      th:each="i : ${#numbers.sequence(0, 4)}">
                </span>
                </div>
                <p th:text="|${review.user.firstName} ${review.user.lastName} - –û—Ü—ñ–Ω–∫–∞: ${review.rating} - ${review.reviewText}|"></p>
            </li>
        </ul>

        <div th:if="${userReview != null}">
            <h4>–í–∞—à –≤—ñ–¥–≥—É–∫:</h4>
            <p th:text="|–û—Ü—ñ–Ω–∫–∞: ${userReview.rating} - ${userReview.reviewText}|"></p>
            <form method="post" th:action="@{/book/{bookId}/review/delete(bookId=${book.id})}">
                <button type="submit">–í–∏–¥–∞–ª–∏—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
            </form>
        </div>

        <div th:if="${userReview == null and session.user == null}">
            <p>–©–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫, –ø–æ—Ç—Ä—ñ–±–Ω–æ <a th:href="@{/user/login}">—É–≤—ñ–π—Ç–∏</a>.</p>
        </div>

        <form method="post"
              th:action="@{/book/{bookId}/review(bookId=${book.id})}"
              th:if="${userReview == null and session.user != null}">
            <input max="5" min="1" name="rating" required type="number"/>
            <input name="comment" required type="text"/>
            <button type="submit">–î–æ–¥–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
        </form>


        <div th:replace="~{fragments/footer :: body}"></div>

</main>

<script th:src="@{/js/cart.js}"></script>
</body>
</html>
